<!DOCTYPE html>
<html>

<head>
    <!-- Importing the Jquery Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script>
        window.onload = function () {
            view_menu();
        };

    </script>

    <script>
        if (localStorage.getItem("userid") == null ||
            localStorage.getItem("fname") == null ||
            localStorage.getItem("lname") == null) {
            window.location.href = "login.html";
        }
    </script>

</head>

<body>

    <h1>Place Order</h1>

    <div>
        <label>User ID:</label><br>
        <div id="userIDDisplay"></div><br>

        <div>
            <a href="userOptions.html">
                <button> Go Back </button>
            </a>
        </div>
        <br>

        <label for="menuid">What would you like to order?</label><br>
        <select id="menuidSelect"></select> <!-- Dropdown for Menu ID -->
        <br>
        <button onclick="place_order()">Submit</button>
        <br>
        <br>
    </div>
    <div id="menuContainer"></div>

    <script>

        var userIdFromStorage = localStorage.getItem("userid");
        console.log('userid -> ', userIdFromStorage)

        var userIDDisplay = document.getElementById("userIDDisplay");
        if (userIDDisplay !== null) {
            userIDDisplay.innerText = userIdFromStorage;
        } else {
            console.log("Element with ID 'userIDDisplay' not found in the DOM.");
        }
        function view_menu() {
            var url = 'http://localhost:4001/api/menus/view_menu';

            $.get(url, function (response, status) {
                if (status === "success") {
                    console.log("Response received:", response); // Log the entire response

                    if (response && Array.isArray(response.data)) {
                        console.log("Data received:", response.data); // Log the data array

                        var menuContainer = document.getElementById("menuContainer");
                        menuContainer.innerHTML = ""; // Clear previous content

                        var menuDropdown = document.getElementById("menuidSelect");
                        menuDropdown.innerHTML = ""; // Clear previous content

                        response.data.forEach(function (menu) {
                            console.log("Menu item:", menu); // Log each menu item to verify its structure

                            var menuElement = document.createElement("div");
                            menuElement.innerHTML = `
                                <p>Menu ID: ${menu.menuid}</p>
                                <p>Name: ${menu.name}</p>
                                <p>Description: ${menu.description}</p>
                                <p>Price: ${menu.price}</p>
                                <hr>
                            `;
                            menuContainer.appendChild(menuElement);

                            var option = document.createElement("option");
                            option.value = menu.menuid;
                            option.textContent = menu.menuid + ' - ' + menu.name; // Set the display text
                            menuDropdown.appendChild(option);
                        });
                    } else {
                        console.log("Data is not in the expected format:", response);
                    }
                } else {
                    console.log("Failed to fetch data. Status:", status);
                }
            });
        }






        function place_order() {
            var userID = userIdFromStorage;
            var menuid = document.getElementById('menuidSelect').value;
            var data = {
                'userid': userID,
                'menuid': menuid
            }
            var url = 'http://localhost:4001/api/users/place_order';

            $.post(url, data, function (data, status) {
                console.log(data.errors);
                alert("Data: " + data + "\nStatus: " + status);
                if (status === "success") {
                    window.location.href = "userOptions.html";
                }
            });
        }

    </script>
</body>

</html>